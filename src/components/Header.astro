---
import Link from '@/components/Link.astro'
import ThemeToggle from '@/components/ThemeToggle.astro'
import MobileMenu from '@/components/ui/mobile-menu'
import SearchButton from '@/components/react/SearchButton'
import { NAV_LINKS, SITE, APP_URL } from '@/consts'
import { Icon } from 'astro-icon/components'

const isExternalLink = (href: string) => {
  return href.startsWith('http')
}
---

<header class="bg-background/50 sticky top-0 z-10 backdrop-blur-md" transition:persist>
  <div class="mx-auto flex max-w-4xl flex-wrap items-center justify-between gap-4 p-4">
    <Link href="/" class="flex shrink-0 items-center gap-2 text-xl font-medium" data-astro-reload>
      <div class="size-8 rounded-lg bg-primary flex items-center justify-center text-primary-foreground font-bold text-sm">
        G
      </div>
      <span class="font-semibold">{SITE.title}</span>
    </Link>
    <div class="flex items-center gap-2 md:gap-4">
      <nav class="hidden items-center gap-4 text-sm sm:gap-6 md:flex">
        {NAV_LINKS.map((item) => {
          const isExternal = isExternalLink(item.href)
          return (
            <Link 
              href={item.href} 
              class="text-foreground/60 hover:text-foreground/80 capitalize transition-colors flex items-center gap-1.5"
            >
              <span>{item.label}</span>
              {isExternal && (
                <Icon 
                  name="lucide:external-link" 
                  class="size-3.5 opacity-70 flex-shrink-0" 
                  aria-hidden="true"
                />
              )}
            </Link>
          )
        })}
        {APP_URL && (
          <a
            href={APP_URL}
            target="_blank"
            rel="noopener noreferrer"
            class="text-primary hover:text-primary/80 font-medium flex items-center gap-1.5 transition-colors"
          >
            <span>App</span>
            <Icon name="lucide:external-link" class="size-3.5 flex-shrink-0" aria-hidden="true" />
          </a>
        )}
      </nav>
      <div class="hidden h-6 w-px bg-border/60 md:block" aria-hidden="true"></div>
      <SearchButton client:idle />
      <MobileMenu client:idle transition:persist />
      <ThemeToggle transition:persist />
    </div>
  </div>
</header>
